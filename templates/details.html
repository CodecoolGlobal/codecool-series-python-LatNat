{% extends 'layout.html' %}

{% block site_specific_head %}
    <script type="text/javascript" src="{{ url_for('static', filename='js/ratings.js') }}"></script>
{% endblock %}

{% block breadcrumbs %}
    <span class="separator">&gt;</span>
    <a href="{{ url_for('all_shows') }}">Shows</a>
    <span class="separator">&gt;</span>
    <a>{{ show['title'] }}</a>
{% endblock %}
{% block content %}
    {% set rounded_rating = show['rating']|round_to_closest(0.5) %}
    <div class="card detailed-view">
        <p>Details:</p>
        <div class="row">
            <div data-show-title="{{ show['title'] }}" class="poster col col-third">
                <div class="loader"></div>
            </div>
            <div class="col col-twothird">
                <h2>{{ show['title'] }}<span class="separator"> </span>{{ show['rating'] }}
                    <div class="rating-star-container">
                        {% for i in range(0,10) %}
                            {% set rating_condition = i + 1 == rounded_rating or i + 0.5 == rounded_rating %}
                            {% if rating_condition %}
                                <div class="rating-star is-selected {{ 'is-half' if rounded_rating|is_float else '' }}"></div>
                                <input id="original-rating" type="hidden" value="is-selected {{ 'is-half' if rounded_rating|is_float else '' }}">
                            {% else %}
                                <div class="rating-star"></div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </h2>
                <p class="small grayed">{{ show['runtime']|convert_runtime }}<span class="separator">|</span>{{ show['genres'] }}</p>
                <p>{{ show['overview']}}</p>
            </div>
        </div>
        <div>
            <p>
                {% if show['stars'] %}
                <b>Stars:</b>
                    {% for index in range(show['stars'].split(',')|length) %}
                        {% if index == (show['stars'].split(',')|length)-1 %}
                            <a href="#">{{ show['stars'].split(',')[index] }}</a>
                        {% else %}
                            <a href="#">{{ show['stars'].split(',')[index] }}</a>,
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </p>
        </div>
    </div>
    <div class="card row">
        <div class="row">
            <div class="col col-twothird">
                <p>Seasons:</p>
                <table>
                    <thead>
                    <tr>
                        <th> </th>
                        <th>Title</th>
                        <th>Overview</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for season in seasons %}
                        <tr>
                            <td>{{ season.season_number }}</td>
                            <td>{{ season.title }}</td>
                            <td>{{ season.overview }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if show['trailer'] != 'No URL' %}
                <div class="col col-third">
                    <p>Trailer: </p>
                    <div id="player" class="trailer" data-video-id="{{ show['trailer'] | get_video_id }}"></div>
                    <script src="{{ url_for('static', filename='js/embed-youtube.js') }}" defer></script>
                </div>
            {% endif %}
        </div>
    </div>
    <script>ratingStarHover()</script>
    <script>displayShowPoster()</script>
{% endblock %}